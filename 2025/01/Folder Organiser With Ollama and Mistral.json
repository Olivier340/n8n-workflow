{"createdAt":"2025-01-29T09:22:40.042Z","updatedAt":"2025-01-29T12:14:59.262Z","id":"XUs6gH0Oc73LSYgW","name":"Folder Organiser With Ollama and Mistral","active":false,"nodes":[{"parameters":{"triggerOn":"folder","path":"/data/shared/messy_folder","events":["add"],"options":{"awaitWriteFinish":true}},"id":"18b42fa4-391c-457f-b374-9ba9780398e3","name":"Local File Trigger","type":"n8n-nodes-base.localFileTrigger","typeVersion":1,"position":[100,300]},{"parameters":{"command":"=ls -p {{ $json.directory }} | grep -v / || true; \\\necho \"===\"; \\\nls -p {{ $json.directory }} | grep / || true;"},"id":"52aeaa39-eb47-4807-a29e-bfeca8efab6c","name":"Get Files and Folders","type":"n8n-nodes-base.executeCommand","typeVersion":1,"position":[580,300]},{"parameters":{"assignments":{"assignments":[{"id":"ad893795-cae8-4418-99e0-2c68126337d3","name":"files","value":"={{ $json.stdout.split('===')[0].split('\\n').filter(item => !item.endsWith('Zone.Identifier')).compact() }}","type":"array"},{"id":"0e7e8571-6b86-481d-a20c-3a7c621c562f","name":"folders","value":"={{ $json.stdout.split('===')[1].split('\\n').compact() }}","type":"array"}]},"options":{}},"id":"b7d655d2-3243-459f-8194-2051765a0b6f","name":"Files and Folders to Array","type":"n8n-nodes-base.set","typeVersion":3.3,"position":[760,300]},{"parameters":{"schemaType":"manual","inputSchema":"{\n\t\"type\": \"array\",\n\t\"items\": {\n    \t\"type\": \"object\",\n        \"properties\": {\n          \"folder\": { \"type\": \"string\" },\n          \"files\": {\n            \"type\": \"array\",\n            \"items\": { \"type\": \"string\" }\n          }\n\t\t}\n    }\n}"},"id":"53bfffce-4876-4bbb-a1dd-b78f8c37b58b","name":"Structured Output Parser","type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[1420,420]},{"parameters":{"assignments":{"assignments":[{"id":"35ea70c4-8669-4975-a68d-bbaa094713c0","name":"directory","value":"={{ $('Local File Trigger').params.path }}","type":"string"}]},"options":{}},"id":"a99923f0-bd22-4229-b650-fdab0201dc30","name":"Set Variables","type":"n8n-nodes-base.set","typeVersion":3.3,"position":[300,300]},{"parameters":{"executeOnce":false,"command":"=directory=\"{{ $('Set Variables').item.json.directory }}\"\nsubdirectory=\"$directory/{{ $json.folder }}\";\nfile_list=\"{{ $json.files.join(' ') }}\";\n\n# create subdirectory if not exists\nmkdir -p $subdirectory;\n\n# for each suggestion, move the file into the subdirectory.\n# If the file in the subdirectory exists, then we'll rename the current file by adding a small random string to the end of the filename.\nfor filename in $file_list; do\n    if [ -e \"$subdirectory/$filename\" ]; then\n        mv \"$directory/$filename-$RANDOM\" -t $subdirectory;\n    else\n        mv \"$directory/$filename\" -t $subdirectory;\n    fi\ndone"},"id":"26dc7e50-17d4-4249-b56d-036fa34890e8","name":"Move Files into Folders","type":"n8n-nodes-base.executeCommand","typeVersion":1,"position":[1940,320]},{"parameters":{"content":"## Step 1. Select the target folder\n[Read more about local file trigger](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.localfiletrigger)\n\nIn this workflow, we'll monitor a specific folder on disk that n8n has access to. Since we're using docker, we can either use the n8n volume or mount a folder from the host machine.\n\nThe local file trigger is useful to execute the workflow whenever changes are made to our target folder.","height":501.2939838391483,"width":483.7926535356806,"color":7},"id":"6ed2e615-cac3-44af-ba76-8e8caa871a5a","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[0,0]},{"parameters":{"content":"## Step 2. Identify files that need to be organised\n[Read more about Execute Command node](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.executecommand)\n\nFor all Files in the root level of our selected target folder, we want  them to be sorted and moved into categorised subdirectories. In this step, we'll use linux commands to get a list of files and folders currently present in the target folder.","height":391.527066537946,"width":583.2857596176409,"color":7},"id":"d08ce1f6-5434-44fa-a28e-673192404718","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[520,120]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"id":"9be5a175-e7aa-4d68-9ddc-8b43b43e2d37","leftValue":"={{ $json.files }}","rightValue":"={{ 1 }}","operator":{"type":"array","operation":"lengthGte","rightType":"number"}}],"combinator":"and"},"options":{}},"id":"6a58d09d-464b-4531-96a7-d29b8b2569e5","name":"If Has Target Files...","type":"n8n-nodes-base.if","typeVersion":2,"position":[940,300]},{"parameters":{"content":"## Step 3. Using Mistral AI to organise our target folder\n[Read more about Mistral AI](https://docs.n8n.io/integrations/builtin/cluster-nodes/sub-nodes/n8n-nodes-langchain.lmchatmistralcloud)\n\nUsing Mistral AI as our AI file manager, it can help us suggest which files go into which categorised subdirectory. If the subdirectory doesn't exist, Mistral can also suggest one to be created.","height":506.8242545618477,"width":631.2649908751414,"color":7},"id":"a970ce97-1f96-4e5d-8ec2-43f57f3def36","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1140,60]},{"parameters":{"fieldToSplitOut":"output","options":{}},"id":"519bf11b-c1a5-4252-b242-155bfdc3a356","name":"Get Suggestions to List","type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[1580,260]},{"parameters":{"content":"## Step 4. Move the files into subdirectories\n[Read more about Execute Command node](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.executecommand)\n\nFor this step, we'll use the execute command node to execute a shellscript to move the files into their respective subdirectories.","height":374.8503908496576,"width":401.0065589583014,"color":7},"id":"524106c4-0180-4cd9-9033-d159e0667672","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1800,100]},{"parameters":{"content":"## Try It Out!\n### This workflow does the following:\n* Monitors a target folder for changes using the local file trigger\n* identifies all files and subdirectories in the target folder and passes this to Mistral AI\n* Mistral AI suggests where to move top level files into which subdirectories. It can also suggest subdirectories tp create if none are suitable.\n* Finally, we take the AI's suggestions are perform the move operations using the execute command node.\n\n### Need Help?\nJoin the [Discord](https://discord.com/invite/XPKeKXeB7d) or ask in the [Forum](https://community.n8n.io/)!\n\nHappy Hacking!","height":422.70324544339167,"width":372.51107341403605},"id":"9ad06938-72be-4850-8c46-89506a89fb67","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-400,20]},{"parameters":{"content":"### ðŸš¨ Warning! Potential destructive operations ahead!\nThis workflow manipulates the filesystem. Always make backups of your files before running local workflows.","height":97.88076166036412,"width":438.23697639546396,"color":3},"id":"b2d142a6-e52e-4f38-b3ac-7756ac333291","name":"Sticky Note5","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-460,460]},{"parameters":{"promptType":"define","text":"=Here is the list of current files in the directory:\n{{ $json.files.map(file => `* ${file}`).join('\\n') }}\n\nHere is the list of current folders in the directory:\n{{ $json.folders.length ? $json.folders.map(item => `* ${item}`).join('\\n') : 'There are currently no directories' }}\n\nGroup the current files using the filename as a hint and decide which of the current folders should they be moved to. If there are no current folders, then suggest a folder to be created.\n\nIf you can't decide which folder to put the file in, the file should be moved to the misc folder.","hasOutputParser":true,"messages":{"messageValues":[{"message":"You manage a linux directory on behalf of the user."}]}},"id":"470ef6a5-694f-4d24-b0df-65507ffabe1b","name":"AI File Manager","type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.4,"position":[1240,260]},{"parameters":{"model":"mistral-nemo:latest","options":{}},"id":"f742280c-1d8a-4e63-bcb6-b39c131406b7","name":"Ollama Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOllama","typeVersion":1,"position":[1240,420],"credentials":{"ollamaApi":{"id":"NS8KtD03um6xedJo","name":"Ollama account"}}}],"connections":{"Local File Trigger":{"main":[[{"node":"Set Variables","type":"main","index":0}]]},"Get Files and Folders":{"main":[[{"node":"Files and Folders to Array","type":"main","index":0}]]},"Files and Folders to Array":{"main":[[{"node":"If Has Target Files...","type":"main","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"AI File Manager","type":"ai_outputParser","index":0}]]},"Set Variables":{"main":[[{"node":"Get Files and Folders","type":"main","index":0}]]},"If Has Target Files...":{"main":[[{"node":"AI File Manager","type":"main","index":0}]]},"Get Suggestions to List":{"main":[[{"node":"Move Files into Folders","type":"main","index":0}]]},"AI File Manager":{"main":[[{"node":"Get Suggestions to List","type":"main","index":0}]]},"Ollama Chat Model":{"ai_languageModel":[[{"node":"AI File Manager","type":"ai_languageModel","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"4e9f99ff-fb59-44b7-89d0-6c66bc0f88d9","triggerCount":0,"tags":[],"repo_owner":"Olivier340","repo_name":"n8n-worklow","repo_path":"","subPath":"2025/01/"}